name: $(Date:yyyyMMdd)$(Rev:.r)

trigger:
  branches:
    include:
    - develop
    - master
    - release/*

pr:
  branches:
    include:
    - develop
    - master
    - release/*

resources:
  repositories:
    - repository: templates
      type: github
      name: CluedIn-io/AzurePipelines.Templates
      endpoint: 'CluedIn-io'
      ref: refs/heads/refactor

pool:
  vmImage: 'windows-latest'

variables:
  - name: testFolderPath
    value: '$(Build.SourcesDirectory)/test'
  - name: DOTNET_SKIP_FIRST_TIME_EXPERIENCE
    value: true
  - name: DOTNET_CLI_TELEMETRY_OPTOUT
    value: true
  - name: buildConfiguration
    value: Release

steps:

  # Configure NuGet
  - task: NuGetAuthenticate@0
    displayName: 'Authenticate with nuget'

  - template: crawler.build.yml@templates
    parameters:
      githubReleaseInMaster: true
      publicReleaseForMaster: false
      
  # Temp Nuget Push for feature/update-net6
  - task: NuGetCommand@2
    displayName: 'Push .NET6 update Nuget packages to Develop feed'
    condition: and ( succeeded(), in(variables['System.PullRequest.SourceBranch'], 'feature/update-net6'))
    inputs:
      command: 'push'
      packagesToPush: '$(Build.ArtifactStagingDirectory)/NuGet/**/*.nupkg'
      allowPackageConflicts: true
      publishVstsFeed: 'develop'